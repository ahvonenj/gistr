var createGist=function(e){if(e._=e._.slice(1),0===e._.length&&(console.log("No files specified"),process.exit(0)),e.b||e.bundle||1===e._.length){var i={};consoleLog("Packing file(s) for gist...",e),asyncLoop(e._,function(t,s){fs.lstat(t,function(o,n){if(o){if(o.code="ENOENT")return consoleLog(t+" does not exist, skipping",e),void s();throw o}if(n.isFile()){var r=t;fs.readFile(r,"utf8",function(e,o){if(e)throw e;i[t]={content:o},s()})}else if(n.isDirectory()){console.log("Multiple directories not supported!"),process.exit(1)}else consoleLog(t+" is not a file, skipping",e),s()})},function(t){if(t)console.error(t.message);else if(0===Object.keys(i).length)console.log("No files to gist");else{consoleLog("Files packed",e),consoleLog("Creating a gist...",e);var s={files:i};s.description=e.d||e.desc||e.description||"",s.public=e.p||e.private||!1,client.post(Github.url+"/gists",{data:JSON.stringify(s),headers:Github.default_headers(e)},function(i,t){var s=parseGistResponse(i,!1);-1!==t.headers.status.indexOf("401")?(console.log("Github returned 401 Unauthorized - there might be a problem with your access-token"),process.exit(1)):isRateLimited(s)?(console.log("You have hit the Github rate-limit, try again later"),process.exit(1)):(consoleLog("Files gisted!",e),storeGists(s))})}})}else{var t=[];asyncLoop(e._,function(i,s){consoleLog("Gisting "+i+"...",e),fs.lstat(i,function(o,n){if(o){if(o.code="ENOENT")return consoleLog(i+" does not exist, skipping",e),void s();throw o}if(n.isFile()){var r=i;fs.readFile(r,"utf8",function(i,o){if(i)throw i;var n={files:{}};n.files[r]={content:o},n.description=e.d||e.desc||e.description||"",n.public=e.p||e.private||!1,client.post(Github.url+"/gists",{data:JSON.stringify(n),headers:Github.default_headers(e)},function(i,o){consoleLog("Gisted "+r,e),-1!==o.headers.status.indexOf("401")&&(console.log("Github returned 401 Unauthorized - there might be a problem with your access-token"),process.exit(1)),t.push(parseGistResponse(i)),s()})})}else if(n.isDirectory()){console.log("Multiple directories not supported!"),process.exit(1)}else consoleLog(i+" is not a file, skipping",e),s()})},function(i){i?console.error(i.message):isRateLimited(t)?(console.log("You have hit the Github rate-limit, try again later"),process.exit(1)):(consoleLog("Files gisted!",e),storeGists(t))})}},listGists=function(e,i){if(void 0===i&&void 0===store.get("gists"))return console.log("No gists stored");for(var i=i||store.get("gists"),t=[],s=0;s<i.length;s++){var o=i[s],n={};n["#"]=void 0!==o.idx?o.idx:s,n.desc=o.description,n.created_at=o.created_at,n.auth=o.authenticated;var r=o.files;n.files=Object.keys(r).join("\n"),t.push(n)}return console.log(columnify(t,{preserveNewLines:!0}))},findGist=function(e){if(void 0===store.get("gists"))return console.log("No gists stored");var i=store.get("gists"),t={extract:function(e){return(e.description.length>0?e.description+"|":"")+Object.keys(e.files).join("|")}},s=fuzzy.filter(e._[1],i,t),o=(s.map(function(e){return e.string}),s.map(function(e){return e.original.idx=e.index,e.original}));listGists(null,o)},showGist=function(e){var i=getGistOrDie(e),t="";for(var s in i.files)if(i.files.hasOwnProperty(s)){var o=i.files[s];t+="\r\n\r\n\r\n"+o.filename+"\r\n\r\nTYPE: "+o.type+"\r\nLANG: "+o.language+"\r\nRAW: "+o.raw_url+"\r\nSIZE: "+o.size}if(e.tofile){var n="gist-"+i.id+".txt";fs.writeFile(process.cwd()+"/"+n,"ID: "+i.id+"\r\nURL: "+i.url+"\r\nHTML URL: "+i.html_url+"\r\nCREATED: "+i.created_at+"\r\nDESC: "+i.description+"\r\nAUTH: "+i.authenticated+"\r\nFILES: "+t,function(e){if(e)throw e;console.log("Created file "+process.cwd()+"\\"+n)})}else console.log("ID: "+i.id+"\nURL: "+i.url+"\nHTML URL: "+i.html_url+"\nCREATED: "+i.created_at+"\nDESC: "+i.description+"\nAUTH: "+i.authenticated+"\nFILES: "+t)},pullGist=function(e){var i=getGistOrDie(e),t=[];for(var s in i.files)if(i.files.hasOwnProperty(s)){var o=i.files[s];t.push(o.raw_url)}console.log(util.inspect(t))};exports.wrap=function(e){e.createGist=createGist,e.listGists=listGists,e.findGist=findGist,e.showGist=showGist,e.pullGist=pullGist};