var exportDatabase=function(e){if(void 0===store.get("gists"))return console.log("No database to export");store.get("gists");if(e.f||e.tofile)consoleLog("Exporting local database to a file",e),fileExists(__dirname+"/.gistr_storage",function(e,o){if(e)throw e;o?(fs.createReadStream(__dirname+"/.gistr_storage").pipe(fs.createWriteStream(process.cwd()+"/gistr-db-export.gs")),console.log("Database exported as a file to your cwd. Keep it safe somewhere."),console.log("NOTE: The database-file might include your Github access-token!")):(console.log("Storage file not found"),process.exit(1))});else{consoleLog("Exporting local database as a gist",e),void 0===store.get("access-token")&&(console.log("Database can only be exported as a gist, if access-token in set"),process.exit(1));var o={_:[null,__dirname+"/.gistr_storage"],d:"gstr database export (WARNING: This gist contains your Github access-token!)"};createGist(o,!0,function(e){var o=e.id;console.log("Database saved as a gist to your Github profile"),console.log("To import database, save and use this gist ID or use the gisted file in your Github profile"),console.log("Gist ID: "+o)})}},importDatabase=function(e){if(e.id)pullGistById(e.id,e,function(o){var t=o.files[Object.keys(o.files)[0]].raw_url;download(t).then(function(o){try{var t=JSON.parse(o.toString())}catch(e){console.log("Pulled gist does not seem to be a gister storage-file"),process.exit(1)}void 0===t.gists&&(console.log("Pulled gist does not seem to be a gister storage-file"),process.exit(1)),fs.writeFile(__dirname+"/.gistr_storage",o,function(o){o&&next(o),global.store=new Storage(__dirname+"/.gistr_storage"),consoleLog("Imported .gistr_storage from Github",e)})})});else{if(!e.f&&!e.file)return console.log('Command needs to be called with --id="<gist id>" or --file="<pathToFile>"');if("boolean"==typeof e.f||"boolean"==typeof e.file)o=process.cwd()+"/gistr-db-export.gs";else var o=e.f||e.file;console.log(o),fileExists(o,function(e,t){if(e)throw e;t?fs.readFile(o,"utf8",function(e,t){if(e)throw e;try{var s=JSON.parse(t)}catch(e){console.log("Supplied file does not seem to be a gister storage-file or it does not contain anything"),process.exit(1)}void 0===s.gists&&(console.log("Supplied file does not seem to be a gister storage-file or it does not contain anything"),process.exit(1)),fs.createReadStream(o).pipe(fs.createWriteStream(__dirname+"/.gistr_storage")),global.store=new Storage(__dirname+"/.gistr_storage"),console.log("Database imported from file.")}):(console.log("Storage file not found"),process.exit(1))})}};exports.wrap=function(e){e.exportDatabase=exportDatabase,e.importDatabase=importDatabase};